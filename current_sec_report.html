<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Golang Security Checker</title>
    <link href="https://securego.io/img/favicon.png" rel="shortcut icon" type="image/png">
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css"
          integrity="sha512-IgmDkwzs96t4SrChW29No3NXBIBv8baW490zk5aXvhCD8vuZM3yUSkbyTBcXohkySecyzIrUwiF/qV0cuPcL3Q=="
          rel="stylesheet"/>
    <link crossorigin="anonymous"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css"
          integrity="sha512-3xLMEigMNYLDJLAgaGlDSxpGykyb+nQnJBzbkQy2a0gyVKL2ZpNOPIj1rD8IPFaJbwAgId/atho1+LBpWu5DhA=="
          rel="stylesheet"/>
    <script crossorigin="anonymous"
            integrity="sha512-Pbb8o120v5/hN/a6LjF4N4Lxou+xYZ0QcVF8J6TWhBbHmctQWd8O6xTDmHpE/91OjPzCk4JRoiJsexHYg4SotQ=="
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"
            type="text/javascript"></script>
    <script crossorigin="anonymous"
            integrity="sha512-xI3f68bgMTOlUAu2yD3kD5NihW8+3Lp/as51nQM4h87u94J39/SQaAklFKWMPIJLOk+mkSZl1PUj/1wJOTYURA=="
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/go.min.js"
            type="text/javascript"></script>
    <script crossorigin="anonymous"
            integrity="sha512-+TFn1Gqbwx/qgwW3NU1/YtFYTfHGeD1e/8YfJZzkb6TFEZP4SUwp1Az9DMeWh3qC0F+YPKXbV3YclMUwBTvO3g=="
            src="https://cdnjs.cloudflare.com/ajax/libs/react/15.7.0/react.min.js" type="text/javascript"></script>
    <script crossorigin="anonymous"
            integrity="sha512-8C49ZG/SaQnWaUgCHTU1o8uIQNYE6R8me38SwF26g2Q0byEXF4Jlvm+T/JAMHMeTBiEVPslSZRv9Xt4AV0pfmw=="
            src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min.js" type="text/javascript"></script>
    <script crossorigin="anonymous"
            integrity="sha512-kp7YHLxuJDJcOzStgd6vtpxr4ZU9kjn77e6dBsivSz+pUuAuMlE2UTdKB7jjsWT84qbS8kdCWHPETnP/ctrFsA=="
            src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"
            type="text/javascript"></script>
    <style>
        .field-label {
            min-width: 80px;
        }

        .break-word {
            word-wrap: break-word;
        }

        .help {
            white-space: pre-wrap;
        }

        .tag {
            width: 80px;
        }

        .summary-first {
            padding: .75rem .75rem .1rem .75rem;
        }

        .summary-last {
            padding: .1rem .75rem .75rem .75rem;
        }

        .summary {
            padding: .1rem .75rem;
        }
    </style>
</head>
<body>
<section class="section">
    <div class="container">
        <div id="content"></div>
    </div>
</section>
<script>
  var data = {
    'Golang errors': {},
    'Issues': [{
      'severity': 'HIGH',
      'confidence': 'HIGH',
      'cwe': { 'id': '295', 'url': 'https://cwe.mitre.org/data/definitions/295.html' },
      'rule_id': 'G402',
      'details': 'TLS Bad Cipher Suite: TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/app/ssl/tls.go',
      'code': '24: \t\t\ttls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,\n25: \t\t\ttls.TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,\n26: \t\t\ttls.TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,\n',
      'line': '25',
      'column': '4',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'MEDIUM',
      'confidence': 'HIGH',
      'cwe': { 'id': '200', 'url': 'https://cwe.mitre.org/data/definitions/200.html' },
      'rule_id': 'G102',
      'details': 'Binds to all network interfaces',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/ackycdn.go',
      'code': '45: \tgo func() {\n46: \t\tln, err := net.Listen(fiber.NetworkTCP, ":443")\n47: \t\tif err != nil {\n',
      'line': '46',
      'column': '14',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/pkg/rpool/pool.go',
      'code': '75: \tfor r := range p.resources {\n76: \t\tr.Close()\n77: \t}\n',
      'line': '76',
      'column': '3',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/pkg/rpool/pool.go',
      'code': '60: \t\tslog.Println("Release", "Closing")\n61: \t\tr.Close()\n62: \t}\n',
      'line': '61',
      'column': '3',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/pkg/rpool/pool.go',
      'code': '52: \tif p.closed { //如果资源池已经关闭，销毁这个资源\n53: \t\tr.Close()\n54: \t\treturn\n',
      'line': '53',
      'column': '3',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/pkg/ratelimiter/manager.go',
      'code': '79: func (m *manager) delete(key string) {\n80: \tm.memory.Delete(key)\n81: }\n',
      'line': '80',
      'column': '2',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/pkg/ratelimiter/manager.go',
      'code': '74: func (m *manager) setRaw(key string, raw []byte, exp time.Duration) {\n75: \tm.memory.Set(key, raw, exp)\n76: }\n',
      'line': '75',
      'column': '2',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/pkg/ratelimiter/manager.go',
      'code': '69: \tdata, _ := binary.Marshal(it)\n70: \tm.memory.Set(key, data, exp)\n71: }\n',
      'line': '70',
      'column': '2',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/pkg/ratelimiter/manager.go',
      'code': '56: \tdata := \u0026item{}\n57: \tbinary.Unmarshal(dataBin, data)\n58: \treturn data\n',
      'line': '57',
      'column': '2',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/app/waf/mdw_sshield.go',
      'code': '57: \t\tcodedToken, _ = token.MarshalMsg(nil)\n58: \t\tapp.G.SessionStorage.Set(ctx.Cookies(CookieAckycdnClearance), codedToken, 10*time.Minute)\n59: \t\treleaseClearanceToken(token)\n',
      'line': '58',
      'column': '3',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/app/waf/mdw_sshield.go',
      'code': '43: \ttoken := acquireClearanceToken()\n44: \ttoken.UnmarshalMsg(codedToken)\n45: \n',
      'line': '44',
      'column': '2',
      'nosec': false,
      'suppressions': null
    }, {
      'severity': 'LOW',
      'confidence': 'HIGH',
      'cwe': { 'id': '703', 'url': 'https://cwe.mitre.org/data/definitions/703.html' },
      'rule_id': 'G104',
      'details': 'Errors unhandled.',
      'file': '/Users/tony/IdeaProjects/ackycdn-node/app/waf/mdw_filter.go',
      'code': '48: \n49: \ttx.RequestBodyBuffer.Write(ctx.Body())\n50: \tif it, _ := tx.ProcessRequestBody(); it != nil {\n',
      'line': '49',
      'column': '2',
      'nosec': false,
      'suppressions': null
    }],
    'Stats': { 'files': 54, 'lines': 5703, 'nosec': 0, 'found': 12 },
    'GosecVersion': 'dev'
  }
</script>
<script type="text/babel">
  var IssueTag = React.createClass({
    render: function () {
      var level = 'tag'
      if (this.props.level === 'HIGH') {
        level += ' is-danger'
      } else if (this.props.level === 'MEDIUM') {
        level += ' is-warning'
      } else if (this.props.level === 'LOW') {
        level += ' is-info'
      } else if (this.props.level === 'WAIVED') {
        level += ' is-success'
      }
      level += ' is-rounded'
      return (
        <div className="control">
          <div className="tags has-addons">
            <span className="tag is-dark is-rounded">{this.props.label}</span>
            <span className={level}>{this.props.level}</span>
          </div>
        </div>
      )
    }
  })
  var Highlight = React.createClass({
    componentDidMount: function () {
      var current = ReactDOM.findDOMNode(this)
      hljs.highlightElement(current)
    },
    render: function () {
      return (
        <pre className="go"><code>{this.props.code}</code></pre>
      )
    }
  })
  var Issue = React.createClass({
    render: function () {
      return (
        <div className="issue box">
          <div className="columns">
            <div className="column is-three-quarters">
              <strong className="break-word">{this.props.data.file} (line {this.props.data.line})</strong>
              <p>{this.props.data.rule_id} (CWE-{this.props.data.cwe.id}): {this.props.data.details}</p>
            </div>
            <div className="column is-one-quarter">
              <div className="field is-grouped is-grouped-multiline">
                {this.props.data.nosec && <IssueTag label="NoSec" level="WAIVED"/>}
                <IssueTag label="Severity" level={this.props.data.severity}/>
                <IssueTag label="Confidence" level={this.props.data.confidence}/>
              </div>
            </div>
          </div>
          <div className="highlight">
            <Highlight key={this.props.data.file + this.props.data.line} code={this.props.data.code}/>
          </div>
        </div>
      )
    }
  })
  var Stats = React.createClass({
    render: function () {
      return (
        <p className="help is-pulled-right">
          Gosec {this.props.data.GosecVersion} scanned {this.props.data.Stats.files.toLocaleString()} files
          with {this.props.data.Stats.lines.toLocaleString()} lines of code.
          {this.props.data.Stats.nosec ? '\n' + this.props.data.Stats.nosec.toLocaleString() + ' false positives (nosec) have been waived.' : ''}
        </p>
      )
    }
  })
  var Issues = React.createClass({
    render: function () {
      if (this.props.data.Stats.files === 0) {
        return (
          <div className="notification">
            No source files found. Do you even Go?
          </div>
        )
      }
      if (this.props.data.Issues.length === 0) {
        return (
          <div>
            <div className="notification">
              Awesome! No issues found!
            </div>
            <Stats data={this.props.data}/>
          </div>
        )
      }
      var issues = this.props.data.Issues
        .filter(function (issue) {
          return this.props.severity.includes(issue.severity)
        }.bind(this))
        .filter(function (issue) {
          return this.props.confidence.includes(issue.confidence)
        }.bind(this))
        .filter(function (issue) {
          if (this.props.issueType) {
            return issue.details.toLowerCase().startsWith(this.props.issueType.toLowerCase())
          } else {
            return true
          }
        }.bind(this))
        .map(function (issue) {
          return (<Issue data={issue}/>)
        }.bind(this))
      if (issues.length === 0) {
        return (
          <div>
            <div className="notification">
              No issues matched given filters
              (of total {this.props.data.Issues.length} issues).
            </div>
            <Stats data={this.props.data}/>
          </div>
        )
      }
      return (
        <div className="issues">
          {issues}
          <Stats data={this.props.data}/>
        </div>
      )
    }
  })
  var LevelSelector = React.createClass({
    handleChange: function (level) {
      return function (e) {
        var updated = this.props.selected
          .filter(function (item) { return item != level })
        if (e.target.checked) {
          updated.push(level)
        }
        this.props.onChange(updated)
      }.bind(this)
    },
    render: function () {
      var HIGH = 'HIGH', MEDIUM = 'MEDIUM', LOW = 'LOW'
      var highDisabled = !this.props.available.includes(HIGH)
      var mediumDisabled = !this.props.available.includes(MEDIUM)
      var lowDisabled = !this.props.available.includes(LOW)
      return (
        <div className="field">
          <div className="control">
            <label className="checkbox" disabled={highDisabled}>
              <input
                type="checkbox"
                checked={this.props.selected.includes(HIGH)}
                disabled={highDisabled}
                onChange={this.handleChange(HIGH)}/> High
            </label>
          </div>
          <div className="control">
            <label className="checkbox" disabled={mediumDisabled}>
              <input
                type="checkbox"
                checked={this.props.selected.includes(MEDIUM)}
                disabled={mediumDisabled}
                onChange={this.handleChange(MEDIUM)}/> Medium
            </label>
          </div>
          <div className="control">
            <label className="checkbox" disabled={lowDisabled}>
              <input
                type="checkbox"
                checked={this.props.selected.includes(LOW)}
                disabled={lowDisabled}
                onChange={this.handleChange(LOW)}/> Low
            </label>
          </div>
        </div>
      )
    }
  })
  var Navigation = React.createClass({
    updateSeverity: function (vals) {
      this.props.onSeverity(vals)
    },
    updateConfidence: function (vals) {
      this.props.onConfidence(vals)
    },
    updateIssueType: function (e) {
      if (e.target.value == 'all') {
        this.props.onIssueType(null)
      } else {
        this.props.onIssueType(e.target.value)
      }
    },
    render: function () {
      var issueTypes = this.props.allIssueTypes
        .map(function (it) {
          var matches = this.props.issueType == it
          return (
            <option value={it} selected={matches}>
              {it}
            </option>
          )
        }.bind(this))
      return (
        <div>
          <nav className="panel">
            <div className="panel-heading">Filters</div>
            <div className="panel-block">
              <div className="field is-horizontal">
                <div className="field-label is-normal">
                  <label className="label is-pulled-left">Severity</label>
                </div>
                <div className="field-body">
                  <LevelSelector selected={this.props.severity} available={this.props.allSeverities}
                                 onChange={this.updateSeverity}/>
                </div>
              </div>
            </div>
            <div className="panel-block">
              <div className="field is-horizontal">
                <div className="field-label is-normal">
                  <label className="label is-pulled-left">Confidence</label>
                </div>
                <div className="field-body">
                  <LevelSelector selected={this.props.confidence} available={this.props.allConfidences}
                                 onChange={this.updateConfidence}/>
                </div>
              </div>
            </div>
            <div className="panel-block">
              <div className="field is-horizontal">
                <div className="field-label is-normal">
                  <label className="label is-pulled-left">Issue type</label>
                </div>
                <div className="field-body">
                  <div className="field">
                    <div className="control">
                      <div className="select is-fullwidth">
                        <select onChange={this.updateIssueType}>
                          <option value="all" selected={!this.props.issueType}>
                            (all)
                          </option>
                          {issueTypes}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </nav>
          <nav className="panel">
            <div className="panel-heading">Summary</div>
            <div className="panel-block">
              <div className="columns is-multiline">
                <div className="column is-half summary-first">
                  <label className="label is-pulled-left">Gosec: </label>
                </div>
                <div className="column is-half summary-first">
                  {this.props.data.GosecVersion}
                </div>
                <div className="column is-half summary">
                  <label className="label is-pulled-left">Files: </label>
                </div>
                <div className="column is-half summary">
                  {this.props.data.Stats.files.toLocaleString()}
                </div>
                <div className="column is-half summary">
                  <label className="label is-pulled-left">Lines: </label>
                </div>
                <div className="column is-half summary">
                  {this.props.data.Stats.lines.toLocaleString()}
                </div>
                <div className="column is-half summary">
                  <label className="label is-pulled-left">Nosec: </label>
                </div>
                <div className="column is-half summary">
                  {this.props.data.Stats.nosec.toLocaleString()}
                </div>
                <div className="column is-half summary-last">
                  <label className="label is-pulled-left">Issues: </label>
                </div>
                <div className="column is-half summary-last">
                  {this.props.data.Stats.found.toLocaleString()}
                </div>
              </div>
            </div>
          </nav>
        </div>
      )
    }
  })
  var IssueBrowser = React.createClass({
    getInitialState: function () {
      return {}
    },
    componentWillMount: function () {
      this.updateIssues(this.props.data)
    },
    handleSeverity: function (val) {
      this.updateIssueTypes(this.props.data.Issues, val, this.state.confidence)
      this.setState({ severity: val })
    },
    handleConfidence: function (val) {
      this.updateIssueTypes(this.props.data.Issues, this.state.severity, val)
      this.setState({ confidence: val })
    },
    handleIssueType: function (val) {
      this.setState({ issueType: val })
    },
    updateIssues: function (data) {
      if (!data) {
        this.setState({ data: data })
        return
      }
      var allSeverities = data.Issues
        .map(function (issue) {
          return issue.severity
        })
        .sort()
        .filter(function (item, pos, ary) {
          return !pos || item != ary[pos - 1]
        })
      var allConfidences = data.Issues
        .map(function (issue) {
          return issue.confidence
        })
        .sort()
        .filter(function (item, pos, ary) {
          return !pos || item != ary[pos - 1]
        })
      var selectedSeverities = allSeverities
      var selectedConfidences = allConfidences
      this.updateIssueTypes(data.Issues, selectedSeverities, selectedConfidences)
      this.setState({
        data: data,
        severity: selectedSeverities,
        allSeverities: allSeverities,
        confidence: selectedConfidences,
        allConfidences: allConfidences,
        issueType: null
      })
    },
    updateIssueTypes: function (issues, severities, confidences) {
      var allTypes = issues
        .filter(function (issue) {
          return severities.includes(issue.severity)
        })
        .filter(function (issue) {
          return confidences.includes(issue.confidence)
        })
        .map(function (issue) {
          return issue.details
        })
        .sort()
        .filter(function (item, pos, ary) {
          return !pos || item != ary[pos - 1]
        })
      if (this.state.issueType && !allTypes.includes(this.state.issueType)) {
        this.setState({ issueType: null })
      }
      this.setState({ allIssueTypes: allTypes })
    },
    render: function () {
      return (
        <div className="content">
          <div className="columns">
            <div className="column is-one-quarter">
              <Navigation
                data={this.props.data}
                severity={this.state.severity}
                confidence={this.state.confidence}
                issueType={this.state.issueType}
                allSeverities={this.state.allSeverities}
                allConfidences={this.state.allConfidences}
                allIssueTypes={this.state.allIssueTypes}
                onSeverity={this.handleSeverity}
                onConfidence={this.handleConfidence}
                onIssueType={this.handleIssueType}
              />
            </div>
            <div className="column is-three-quarters">
              <Issues
                data={this.props.data}
                severity={this.state.severity}
                confidence={this.state.confidence}
                issueType={this.state.issueType}
              />
            </div>
          </div>
        </div>
      )
    }
  })
  ReactDOM.render(
    <IssueBrowser data={data}/>,
    document.getElementById('content')
  )
</script>
</body>
</html>